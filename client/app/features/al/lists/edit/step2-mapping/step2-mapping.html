<h3 class="title_section">List: <span>{{$ctrl.listName}}</span></h3>

<div class="subtitle_section">
    <h3 class="pull-left">List Update</h3>
    <div class="pull-right">
        <button class="btn btn-black btn-sm rigth-space-sm" ui-sref="underconstruction">Back</button>
        <button class="btn btn-black btn-sm" ui-sref="ap.al.lists">Cancel</button>
    </div>
</div>

<abx-message msg="$ctrl.message"></abx-message>
<div ng-if="!$ctrl.canMapping">Sorry you need a file to map</div>
<div ng-if="$ctrl.canMapping">
    <abx-load-indicator ng-show="$ctrl.contactFields.length==0" text="Loading Contacts Fields"></abx-load-indicator>
    <div ng-show="$ctrl.contactFields.length>0">
        <p>Set mapping from source fields to Contact fields</p>

        <div class="header-table-mapping">
            <div class="row">
                <div class="col-md-7">
                    <p>
                        <span>Delimiter </span>
                        <select name="del" ng-model="$ctrl.selectedDelimiter" ng-change="$ctrl.changeDelimiter()" ng-options="delimiter.title for delimiter in $ctrl.delimiters"></select>
                        <span>Custom </span>
                        <input type="text" ng-model="$ctrl.selectedSymbolDelimiter" maxlength="1" ng-change="$ctrl.changeDelimiter()" ng-disabled="!$ctrl.customDelimiterEnabled">

                      
                        <label>
                            <input type="checkbox" ng-model="$ctrl.hasHeader" ng-change="$ctrl.changeHeaderValue()">Has header

                    </p>
                    <p>
                        <button class="btn btn-primary" ng-click="$ctrl.matchSmart()" ng-disabled="!$ctrl.hasHeader">Smart mapping</button>
                        <button class="btn btn-primary" ng-click="$ctrl.clearMapping()">Clear mapping</button>
                    </p>
                </div>
                <div class="col-md-5">
                    <p>
                        <span>Contact Field </span>
                        <select id="contactSelect" ng-model="$ctrl.contactFieldSelectedName" ng-options="str.name for str in $ctrl.contactFieldsNames"></select>
                    </p>
                    <p>
                        <button class="btn btn-primary" ng-click="$ctrl.addMappingItem()">Add mapping item</button>
                        <button class="btn btn-primary" ng-click="$ctrl.removeSelectedItem()"  ng-disabled="$ctrl.selectedRow==-1">Remove selected items</button>
                    </p>
                </div>
            </div>
        </div>

        <table class="table table-striped table-full-condensed table-selectable table-scrollable">

            <thead>
                <th width="350">Source Field
                    <span ng-show="$ctrl.hasHeader">Name</span>
                    <span ng-show="!$ctrl.hasHeader">Index</span>
                </th>
                <th>Contact Field</th>
                <th width="100" class="text-center">
                    Key
                </th>
            </thead>
            <tbody>
                <tr ng-repeat="field in $ctrl.contactFields track by $index" ng-click="$ctrl.selectedRow=$index" ng-class="{'rowselected':$ctrl.selectedRow==$index}">
                    <td>
                        <select class="cell-select" ng-if="$ctrl.hasHeader" ng-model="field.mappedName" ng-options="o for o in $ctrl.jsonCSV[0]">
                            <option value="">==</option>
                        </select>
                        <abx-number-updown class="number-updown-width" ng-model="field.mappedIndex" max-value="256" ng-if="!$ctrl.hasHeader"></abx-number-updown>
                    </td>
                    <td>{{field.name}}</td>
                    <td class="text-center">
                        <input ng-if="field.isKey!=undefined" class="cell-checkbox" type="checkbox" ng-model="field.isKey">
                    </td>
                </tr>
            </tbody>
        </table>
        <div style="margin-bottom: 36px" class="text-center">
            <button class="btn btn-black btn-sm" ng-click="$ctrl.finishMap()">Import</button>
        </div>

    </div>
</div>