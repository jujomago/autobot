<h3 class="title_section">List: <span>{{$ctrl.listName}}</span></h3>

<div class="subtitle_section">
    <h3 class="pull-left">List update</h3>
    <div class="pull-right">
        <button class="btn btn-black btn-sm rigth-space-sm" ui-sref="underconstruction">Back</button>
        <button class="btn btn-black btn-sm" ui-sref="ap.al.lists">Cancel</button>
    </div>
</div>

<abx-message msg="$ctrl.message"></abx-message>
<div ng-if="!$ctrl.canMapping">Sorry you need a file to map</div>
<div ng-if="$ctrl.canMapping">    
        <p>Set mapping from source fields to Contact fields:</p>
        <div class="header-table-mapping">

            <div class="row">                  
                    <div class="separator">
                        <span>Delimiter </span>
                        <select name="del" ng-model="$ctrl.selectedDelimiter" ng-change="$ctrl.changeDelimiter()" ng-options="delimiter.title for delimiter in $ctrl.delimiters"></select>
                    </div>
                    <div class="separator">
                        <span>Custom </span>
                        <input type="text" ng-model="$ctrl.customDelimiterDefaultSymbol" maxlength="1" ng-change="$ctrl.changeDelimiter()" ng-disabled="!$ctrl.customDelimiterEnabled">
                    </div>
                    <label class="separator">
                        <input type="checkbox" ng-model="$ctrl.hasHeader" ng-change="$ctrl.changeHeaderValue()">Has header
                    </label>
                    <button class="btn btn-primary" ng-click="$ctrl.matchSmart()" ng-disabled="!$ctrl.hasHeader">Smart mapping</button>
                    <button class="btn btn-primary" ng-click="$ctrl.clearMapping()">Clear mapping</button>
                    <br/>
            </div>
            <div class="row">
                    <div class="separator">
                      <span>Contact Field</span>
                      <select id="contactSelect" ng-model="$ctrl.contactFieldSelectedName" ng-options="str.name for str in $ctrl.contactFieldsNames"></select>
                    </div>
                    <button class="btn btn-primary" ng-click="$ctrl.addMappingItem()">Add mapping item</button>                                    

            </div>
        </div>
        <abx-load-indicator ng-show="$ctrl.contactFields.length==0 && $ctrl.loadingContacts==true" text="Loading Contacts Fields" absolute="false"></abx-load-indicator>
        <table class="table table-striped table-full-condensed table-y-scroll table-y-scroll-col4" ng-show="$ctrl.contactFields.length>0" ng-class="{'table-y-scroll-showscroll':$ctrl.contactFields.length>10}">
            <thead>
                <th width="350">Source field
                    <span ng-show="$ctrl.hasHeader">name</span>
                    <span ng-show="!$ctrl.hasHeader">index</span>
                </th>
                <th class="capitalize">Contact field</th>
                <th width="100" class="text-center">
                    Key
                </th>
                 <th width="100" class="text-center">
                    Actions
                </th>
            </thead>
            <tbody>
                <tr ng-repeat="field in $ctrl.contactFields track by $index" ng-class="{'selectedRowMapped':$ctrl.seletedRowsMapped.indexOf($index)>=0}">
                    <td>
                        <select class="cell-select" ng-class="{'withArrow':field.mappedName===null}" ng-if="$ctrl.hasHeader" ng-model="field.mappedName" ng-options="o for o in $ctrl.jsonHeaders">
                            <option value=""></option>
                        </select>
                        <abx-number-updown class="number-updown-width" ng-model="field.mappedIndex" max-value="256" ng-if="!$ctrl.hasHeader"></abx-number-updown>
                    </td>
                    <td class="capitalize">{{field.name}}</td>
                    <td class="text-center">
                        <input ng-if="field.isKey!=undefined" class="cell-checkbox" type="checkbox" ng-model="field.isKey">
                    </td>
                    <td class="text-center">
                        <a href class="circle_delete" ng-click="$ctrl.selectedRow=$index;$ctrl.removeSelectedItem()" ng-hide="$ctrl.selectedRow==$index "></a>
                    </td>
                </tr>
            </tbody>
        </table>
        <div style="margin-bottom: 36px" class="text-center">
            <button class="btn btn-black" ng-click="$ctrl.finishMap()" ng-disabled="$ctrl.contactFields.length<=0" ng-show="$ctrl.contactFields.length>0">Import</button>
        </div>
</div>
